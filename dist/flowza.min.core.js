!function(){let t="#app",e={cache:new class t{constructor(t=10){this.limit=t,this.map=new Map}get(t){if(!this.map.has(t))return null;let e=this.map.get(t);return this.map.delete(t),this.map.set(t,e),e}set(t,e){if(this.map.has(t)&&this.map.delete(t),this.map.set(t,e),this.map.size>this.limit){let s=this.map.keys().next().value;this.map.delete(s)}}}(10),hooks:{before:[],after:[],beforeEnter:[],afterEnter:[],beforeLeave:[],afterLeave:[]},currentURL:location.pathname+location.search,loadedAssets:{css:new Set,js:new Set},scrollPositions:{},transitions:{fade:{leave:t=>new Promise(e=>{t.style.opacity="1",t.style.transition="opacity 0.3s ease",t.offsetWidth,t.style.opacity="0",t.addEventListener("transitionend",function s(i){"opacity"===i.propertyName&&(t.removeEventListener("transitionend",s),e())})}),enter:t=>new Promise(e=>{t.style.opacity="0",t.style.transition="opacity 0.3s ease",t.offsetWidth,t.style.opacity="1",t.addEventListener("transitionend",function s(i){"opacity"===i.propertyName&&(t.removeEventListener("transitionend",s),e())})})},overlay:{leave:t=>new Promise(t=>{let e=document.getElementById("flowza-overlay");e||((e=document.createElement("div")).id="flowza-overlay",Object.assign(e.style,{position:"fixed",top:"0",left:"0",width:"100vw",height:"100vh",backgroundColor:"#111",zIndex:"9999",pointerEvents:"none",opacity:"0",transition:"opacity 0.5s ease"}),document.body.appendChild(e)),e.style.opacity="0",e.offsetWidth,e.style.opacity="1",e.addEventListener("transitionend",function s(i){"opacity"===i.propertyName&&(e.removeEventListener("transitionend",s),t())})}),enter:t=>new Promise(t=>{let e=document.getElementById("flowza-overlay");if(!e){t();return}e.style.transition="opacity 0.5s ease",e.style.opacity="1",e.offsetWidth,e.style.opacity="0",e.addEventListener("transitionend",function s(i){"opacity"===i.propertyName&&(e.removeEventListener("transitionend",s),e.remove(),t())})})},slideLeft:{leave:t=>new Promise(e=>{t.style.transform="translateX(0%)",t.style.transition="transform 0.4s ease-in",t.offsetWidth,t.style.transform="translateX(-100%)",t.addEventListener("transitionend",function s(i){"transform"===i.propertyName&&(t.removeEventListener("transitionend",s),e())})}),enter:t=>new Promise(e=>{t.style.transform="translateX(100%)",t.style.transition="transform 0.4s ease-out",t.offsetWidth,t.style.transform="translateX(0%)",t.addEventListener("transitionend",function s(i){"transform"===i.propertyName&&(t.removeEventListener("transitionend",s),e())})})},zoom:{leave:t=>new Promise(e=>{t.style.transform="scale(1)",t.style.opacity="1",t.style.transition="transform 0.4s ease, opacity 0.4s ease",t.offsetWidth,t.style.transform="scale(0.8)",t.style.opacity="0";let s=0;function i(r){("transform"===r.propertyName||"opacity"===r.propertyName)&&++s>=2&&(t.removeEventListener("transitionend",i),e())}t.addEventListener("transitionend",i)}),enter:t=>new Promise(e=>{t.style.transform="scale(1.2)",t.style.opacity="0",t.style.transition="transform 0.4s ease, opacity 0.4s ease",t.offsetWidth,t.style.transform="scale(1)",t.style.opacity="1";let s=0;function i(r){("transform"===r.propertyName||"opacity"===r.propertyName)&&++s>=2&&(t.removeEventListener("transitionend",i),e())}t.addEventListener("transitionend",i)})},overlaySlideUp:{leave:t=>new Promise(t=>{let e=document.getElementById("flowza-overlay");e||((e=document.createElement("div")).id="flowza-overlay",Object.assign(e.style,{position:"fixed",top:"-100vh",left:"0",width:"100vw",height:"100vh",backgroundColor:"#111",zIndex:"9999",pointerEvents:"none",opacity:"1",transition:"top 0.5s ease, opacity 0.5s ease"}),document.body.appendChild(e)),e.style.top="-100vh",e.style.opacity="1",e.offsetWidth,e.style.top="0vh",e.addEventListener("transitionend",function s(i){"top"===i.propertyName&&(e.removeEventListener("transitionend",s),t())})}),enter:t=>new Promise(t=>{let e=document.getElementById("flowza-overlay");if(!e){t();return}e.style.transition="top 0.5s ease, opacity 0.5s ease",e.style.top="0vh",e.style.opacity="1",e.offsetWidth,e.style.top="-100vh",e.addEventListener("transitionend",function s(i){"top"===i.propertyName&&(e.removeEventListener("transitionend",s),e.remove(),t())})})}},on(t,e){if(this.hooks[t])this.hooks[t].push(e);else throw Error("Unknown hook "+t)},async init(){if("scrollRestoration"in history&&(history.scrollRestoration="manual"),this.app=document.querySelector(t),!this.app)throw Error("Root selector not found: "+t);this.trackAssets(document),this.bindLinks(),window.addEventListener("popstate",()=>{let t=location.pathname+location.search+location.hash;console.log(currentPage);let e=location.pathname+location.search;console.log(e);let s=currentPage===e;console.log(s),currentPage=window.location.pathname;let i=this.scrollPositions[t];this.go(t,{history:!1}).then(()=>{"number"==typeof i&&window.scrollTo({top:i,left:0,behavior:s?"auto":"instant"})}).catch(console.error)}),this.bindPrefetch()},bindLinks(){document.addEventListener("click",t=>{let e=t.target.closest("a");if(!e)return;let s=e.getAttribute("href");if(s){if("#"===s){t.preventDefault(),this.currentURL&&(this.scrollPositions[location.pathname+location.search+location.hash]=window.scrollY),window.scrollTo({top:0,left:0,behavior:"auto"}),history&&window.history.pushState({},"",s),this.currentURL=location.pathname+location.search+"#";return}if(s.startsWith("#")){t.preventDefault(),this.currentURL&&(this.scrollPositions[location.pathname+location.search+location.hash]=window.scrollY);let i=document.querySelector(s);i?i.scrollIntoView({behavior:"auto"}):window.scrollTo({top:0,left:0,behavior:"auto"}),history&&window.history.pushState({},"",s),this.currentURL=location.pathname+location.search+s;return}s.startsWith("http")&&new URL(s,location.href).origin!==location.origin||(t.preventDefault(),this.go(s).catch(t=>{console.error(t),location.href=s}))}})},bindPrefetch(){let t=null;document.addEventListener("mouseover",e=>{let s=e.target.closest("a");if(!s)return;let i=s.getAttribute("href");i&&(t=setTimeout(()=>{this.prefetch(i)},80))}),document.addEventListener("mouseout",()=>{t&&clearTimeout(t)})},async prefetch(t){if(!this.cache.get(t))try{let e=await fetch(t,{headers:{"X-Requested-With":"flowza"}});if(!e.ok)return;let s=await e.text(),i=this.parseHTML(s);this.cache.set(t,i)}catch(r){}},parseHTML(e){let s=new DOMParser,i=s.parseFromString(e,"text/html"),r=i.querySelector(t);if(!r)throw Error("Response did not contain "+t);return{html:r.innerHTML,title:i.title||document.title,view:r.getAttribute("data-view")||"",css:Array.from(i.querySelectorAll('link[rel="stylesheet"]')).map(t=>({href:t.href,init:t.hasAttribute("data-init")})),js:Array.from(i.querySelectorAll("script[src]")).map(t=>({src:t.src,init:t.hasAttribute("data-init")}))}},async go(t,{history:e=!0}={}){this.currentURL&&(this.scrollPositions[location.pathname+location.search+location.hash]=window.scrollY);let s=new URL(t,location.href),i=s.pathname+s.search,r=s.hash,n=this.currentURL,o=this.currentURL.split("#")[0];if(i===o&&r){this.currentURL&&(this.scrollPositions[location.pathname+location.search+location.hash]=window.scrollY),e&&window.history.pushState({},"",s.href);let a=document.querySelector(r);a?a.scrollIntoView({behavior:"auto"}):window.scrollTo({top:0,left:0,behavior:"auto"}),this.currentURL=i+r;return}if(i===o&&!r&&n.includes("#")){this.currentURL&&(this.scrollPositions[location.pathname+location.search+location.hash]=window.scrollY),e&&window.history.pushState({},"",s.href);let l=this.scrollPositions[i+(n.includes("#")?n.split("#")[1]:"")];void 0!==l?window.scrollTo({top:l,left:0,behavior:"smooth"}):window.scrollTo({top:0,left:0,behavior:"smooth"}),this.currentURL=i;return}if(!1===e){await this._navigatePage(s,e,{disableTransition:!0});return}await this._navigatePage(s,e,{hash:r})},async _navigatePage(t,e,{disableTransition:s=!1,hash:i=""}={}){let r=t.pathname+t.search;await this.runHooks("before",{from:this.currentURL,to:r});let n=this.cache.get(r);if(!n){let o=await fetch(r,{headers:{"X-Requested-With":"flowza"}});if(!o.ok)throw Error("Failed to fetch "+r);n=this.parseHTML(await o.text()),this.cache.set(r,n)}if(s||(await this.runHooks("beforeLeave",{from:this.currentURL,to:r}),await this.transitionLeave(this.app),await this.runHooks("afterLeave",{from:this.currentURL,to:r})),document.title=n.title,this.app.setAttribute("data-view",n.view),this.app.innerHTML=n.html,s){let a=this.scrollPositions[r+(i||"")];"number"==typeof a?window.scrollTo({top:a,left:0,behavior:"instant"}):window.scrollTo({top:0,left:0,behavior:"auto"})}else if(i){let l=document.querySelector(i);l?l.scrollIntoView({behavior:"instant"}):window.scrollTo({top:0,left:0,behavior:"instant"})}else window.scrollTo({top:0,left:0,behavior:"instant"});document.querySelectorAll('link[rel="stylesheet"][data-init]').forEach(t=>{n.css.some(e=>e.href===t.href)||(t.remove(),this.loadedAssets.css.delete(t.href))}),document.querySelectorAll("script[src][data-init]").forEach(t=>{n.js.some(e=>e.src===t.src)||(t.remove(),this.loadedAssets.js.delete(t.src))}),this.injectAssets(n.css,n.js),e&&window.history.pushState({},"",t.href),this.currentURL=r+(i||""),s||(await this.runHooks("beforeEnter",{from:this.currentURL,to:r}),await this.transitionEnter(this.app),await this.runHooks("afterEnter",{from:this.currentURL,to:r})),await this.runHooks("after",{from:this.currentURL,to:r})},trackAssets(t){t.querySelectorAll('link[rel="stylesheet"]').forEach(t=>this.loadedAssets.css.add(t.href)),t.querySelectorAll("script[src]").forEach(t=>this.loadedAssets.js.add(t.src))},injectAssets(t,e){t.forEach(({href:t,init:e})=>{if(!this.loadedAssets.css.has(t)){let s=document.createElement("link");s.rel="stylesheet",s.href=t,e&&s.setAttribute("data-init","true"),document.head.appendChild(s),this.loadedAssets.css.add(t)}}),e.forEach(({src:t,init:e})=>{let s=this.loadedAssets.js.has(t);if(!s||e){let i=document.createElement("script");i.src=t,i.defer=!0,e&&i.setAttribute("data-init","true"),document.body.appendChild(i),s||this.loadedAssets.js.add(t)}})},async runHooks(t,e){for(let s of this.hooks[t]||[])await s(e)},runCSSTransition:t=>new Promise(e=>{let s=[];for(let i in t){let r=t[i];if("function"==typeof r){s.push(r());continue}let n=i,o=r;if(!o||"object"!=typeof o)continue;let a=Number(o.duration)||.3,l=Number(o.delay)||0,h={...o};delete h.duration,delete h.delay;let c="head"===n?[document.head]:Array.from(document.querySelectorAll(n));0!==c.length&&c.forEach(t=>{let e=new Promise(e=>{let s={};for(let i in h)s[i]=t.style[i]||"";let r=Object.keys(h).join(", ");for(let n in t.style.transition=r.split(", ").map(t=>`${t} ${a}s ease ${l}s`).join(", "),t.offsetWidth,h)t.style[n]=h[n];setTimeout(()=>{for(let i in h)t.style[i]=s[i];t.style.transition="",e()},(a+l)*1e3)});s.push(e)})}Promise.all(s).then(()=>e())}),setTransitions(t,e){!t||"object"!=typeof t||t instanceof Function?t instanceof Function?this.transitionLeave=t:this.transitionLeave=()=>Promise.resolve():this.transitionLeave=()=>this.runCSSTransition(t),!e||"object"!=typeof e||e instanceof Function?e instanceof Function?this.transitionEnter=e:this.transitionEnter=()=>Promise.resolve():this.transitionEnter=()=>this.runCSSTransition(e)},useTransition(t){if(!this.transitions[t])throw Error("Unknown transition: "+t);let{leave:e,enter:s}=this.transitions[t];this.setTransitions(e,s)}};window.flowza={init:()=>e.init(),go:t=>e.go(t),on:(t,s)=>e.on(t,s),prefetch:t=>e.prefetch(t),setTransitions:(t,s)=>e.setTransitions(t,s),useTransition:t=>e.useTransition(t)},flowza.on("after",()=>{currentPage=window.location.pathname,console.log("updated current"+currentPage)}),document.addEventListener("DOMContentLoaded",()=>{flowza.init().catch(console.error)}),window.flowza._Router=e}();
