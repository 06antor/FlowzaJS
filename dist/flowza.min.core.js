!function(){let t="#app",e="a[data-router-link]",s={cache:new class t{constructor(t=10){this.limit=t,this.map=new Map}get(t){if(!this.map.has(t))return null;let e=this.map.get(t);return this.map.delete(t),this.map.set(t,e),e}set(t,e){if(this.map.has(t)&&this.map.delete(t),this.map.set(t,e),this.map.size>this.limit){let s=this.map.keys().next().value;this.map.delete(s)}}}(10),hooks:{before:[],after:[],beforeEnter:[],afterEnter:[],beforeLeave:[],afterLeave:[]},currentURL:location.pathname+location.search,loadedAssets:{css:new Set,js:new Set},transitions:{fade:{leave:t=>new Promise(e=>{t.style.opacity="1",t.style.transition="opacity 0.3s ease",t.offsetWidth,t.style.opacity="0",t.addEventListener("transitionend",function s(i){"opacity"===i.propertyName&&(t.removeEventListener("transitionend",s),e())})}),enter:t=>new Promise(e=>{t.style.opacity="0",t.style.transition="opacity 0.3s ease",t.offsetWidth,t.style.opacity="1",t.addEventListener("transitionend",function s(i){"opacity"===i.propertyName&&(t.removeEventListener("transitionend",s),e())})})},overlay:{leave:t=>new Promise(t=>{let e=document.getElementById("flowza-overlay");e||((e=document.createElement("div")).id="flowza-overlay",Object.assign(e.style,{position:"fixed",top:"0",left:"0",width:"100vw",height:"100vh",backgroundColor:"#111",zIndex:"9999",pointerEvents:"none",opacity:"0",transition:"opacity 0.5s ease"}),document.body.appendChild(e)),e.style.opacity="0",e.offsetWidth,e.style.opacity="1",e.addEventListener("transitionend",function s(i){"opacity"===i.propertyName&&(e.removeEventListener("transitionend",s),t())})}),enter:t=>new Promise(t=>{let e=document.getElementById("flowza-overlay");if(!e){t();return}e.style.transition="opacity 0.5s ease",e.style.opacity="1",e.offsetWidth,e.style.opacity="0",e.addEventListener("transitionend",function s(i){"opacity"===i.propertyName&&(e.removeEventListener("transitionend",s),e.remove(),t())})})},slideLeft:{leave:t=>new Promise(e=>{t.style.transform="translateX(0%)",t.style.transition="transform 0.4s ease-in",t.offsetWidth,t.style.transform="translateX(-100%)",t.addEventListener("transitionend",function s(i){"transform"===i.propertyName&&(t.removeEventListener("transitionend",s),e())})}),enter:t=>new Promise(e=>{t.style.transform="translateX(100%)",t.style.transition="transform 0.4s ease-out",t.offsetWidth,t.style.transform="translateX(0%)",t.addEventListener("transitionend",function s(i){"transform"===i.propertyName&&(t.removeEventListener("transitionend",s),e())})})},zoom:{leave:t=>new Promise(e=>{t.style.transform="scale(1)",t.style.opacity="1",t.style.transition="transform 0.4s ease, opacity 0.4s ease",t.offsetWidth,t.style.transform="scale(0.8)",t.style.opacity="0";let s=0;function i(n){("transform"===n.propertyName||"opacity"===n.propertyName)&&++s>=2&&(t.removeEventListener("transitionend",i),e())}t.addEventListener("transitionend",i)}),enter:t=>new Promise(e=>{t.style.transform="scale(1.2)",t.style.opacity="0",t.style.transition="transform 0.4s ease, opacity 0.4s ease",t.offsetWidth,t.style.transform="scale(1)",t.style.opacity="1";let s=0;function i(n){("transform"===n.propertyName||"opacity"===n.propertyName)&&++s>=2&&(t.removeEventListener("transitionend",i),e())}t.addEventListener("transitionend",i)})},overlaySlideUp:{leave:t=>new Promise(t=>{let e=document.getElementById("flowza-overlay");e||((e=document.createElement("div")).id="flowza-overlay",Object.assign(e.style,{position:"fixed",top:"-100vh",left:"0",width:"100vw",height:"100vh",backgroundColor:"#111",zIndex:"9999",pointerEvents:"none",opacity:"1",transition:"top 0.5s ease, opacity 0.5s ease"}),document.body.appendChild(e)),e.style.top="-100vh",e.style.opacity="1",e.offsetWidth,e.style.top="0vh",e.addEventListener("transitionend",function s(i){"top"===i.propertyName&&(e.removeEventListener("transitionend",s),t())})}),enter:t=>new Promise(t=>{let e=document.getElementById("flowza-overlay");if(!e){t();return}e.style.transition="top 0.5s ease, opacity 0.5s ease",e.style.top="0vh",e.style.opacity="1",e.offsetWidth,e.style.top="-100vh",e.addEventListener("transitionend",function s(i){"top"===i.propertyName&&(e.removeEventListener("transitionend",s),e.remove(),t())})})}},on(t,e){if(this.hooks[t])this.hooks[t].push(e);else throw Error("Unknown hook "+t)},async init(){if(this.app=document.querySelector(t),!this.app)throw Error("Root selector not found: "+t);this.trackAssets(document),this.bindLinks(),window.addEventListener("popstate",()=>{let t=location.pathname+location.search;this.go(t,{history:!1}).catch(console.error)}),this.bindPrefetch()},bindLinks(){document.addEventListener("click",t=>{let s=t.target.closest(e);if(!s)return;let i=s.getAttribute("href");!i||i.startsWith("http")&&new URL(i,location.href).origin!==location.origin||(t.preventDefault(),this.go(i).catch(t=>{console.error(t),location.href=i}))})},bindPrefetch(){let t=null;document.addEventListener("mouseover",s=>{let i=s.target.closest(e);if(!i)return;let n=i.getAttribute("href");n&&(t=setTimeout(()=>{this.prefetch(n)},80))}),document.addEventListener("mouseout",()=>{t&&clearTimeout(t)})},async prefetch(t){if(!this.cache.get(t))try{let e=await fetch(t,{headers:{"X-Requested-With":"flowza"}});if(!e.ok)return;let s=await e.text(),i=this.parseHTML(s);this.cache.set(t,i)}catch(n){}},parseHTML(e){let s=new DOMParser,i=s.parseFromString(e,"text/html"),n=i.querySelector(t);if(!n)throw Error("Response did not contain "+t);return{html:n.innerHTML,title:i.title||document.title,view:n.getAttribute("data-view")||"",css:Array.from(i.querySelectorAll('link[rel="stylesheet"]')).map(t=>({href:t.href,init:t.hasAttribute("data-init")})),js:Array.from(i.querySelectorAll("script[src]")).map(t=>({src:t.src,init:t.hasAttribute("data-init")}))}},async go(t,{history:e=!0}={}){let s=new URL(t,location.href).pathname+new URL(t,location.href).search;await this.runHooks("before",{from:this.currentURL,to:s});let i=this.cache.get(s);if(!i){let n=await fetch(s,{headers:{"X-Requested-With":"flowza"}});if(!n.ok)throw Error("Failed to fetch "+s);i=this.parseHTML(await n.text()),this.cache.set(s,i)}await this.runHooks("beforeLeave",{from:this.currentURL,to:s}),await this.transitionLeave(this.app),await this.runHooks("afterLeave",{from:this.currentURL,to:s}),document.title=i.title,this.app.setAttribute("data-view",i.view),this.app.innerHTML=i.html,window.scrollTo(0,0),document.querySelectorAll('link[rel="stylesheet"][data-init]').forEach(t=>{i.css.some(e=>e.href===t.href)||(t.remove(),this.loadedAssets.css.delete(t.href))}),document.querySelectorAll("script[src][data-init]").forEach(t=>{i.js.some(e=>e.src===t.src)||(t.remove(),this.loadedAssets.js.delete(t.src))}),this.injectAssets(i.css,i.js),e&&window.history.pushState({},"",s),this.currentURL=s,await this.runHooks("beforeEnter",{from:this.currentURL,to:s}),await this.transitionEnter(this.app),await this.runHooks("afterEnter",{from:this.currentURL,to:s}),await this.runHooks("after",{from:this.currentURL,to:s})},trackAssets(t){t.querySelectorAll('link[rel="stylesheet"]').forEach(t=>this.loadedAssets.css.add(t.href)),t.querySelectorAll("script[src]").forEach(t=>this.loadedAssets.js.add(t.src))},injectAssets(t,e){t.forEach(({href:t,init:e})=>{if(!this.loadedAssets.css.has(t)){let s=document.createElement("link");s.rel="stylesheet",s.href=t,e&&s.setAttribute("data-init","true"),document.head.appendChild(s),this.loadedAssets.css.add(t)}}),e.forEach(({src:t,init:e})=>{let s=this.loadedAssets.js.has(t);if(!s||e){let i=document.createElement("script");i.src=t,i.defer=!0,e&&i.setAttribute("data-init","true"),document.body.appendChild(i),s||this.loadedAssets.js.add(t)}})},async runHooks(t,e){for(let s of this.hooks[t]||[])await s(e)},runCSSTransition:t=>new Promise(e=>{let s=[];for(let i in t){let n=t[i];if("function"==typeof n){s.push(n());continue}let r=i,a=n;if(!a||"object"!=typeof a)continue;let o=Number(a.duration)||.3,l=Number(a.delay)||0,h={...a};delete h.duration,delete h.delay;let d="head"===r?[document.head]:Array.from(document.querySelectorAll(r));0!==d.length&&d.forEach(t=>{let e=new Promise(e=>{let s={};for(let i in h)s[i]=t.style[i]||"";let n=Object.keys(h).join(", ");for(let r in t.style.transition=n.split(", ").map(t=>`${t} ${o}s ease ${l}s`).join(", "),t.offsetWidth,h)t.style[r]=h[r];setTimeout(()=>{for(let i in h)t.style[i]=s[i];t.style.transition="",e()},(o+l)*1e3)});s.push(e)})}Promise.all(s).then(()=>e())}),setTransitions(t,e){!t||"object"!=typeof t||t instanceof Function?t instanceof Function?this.transitionLeave=t:this.transitionLeave=()=>Promise.resolve():this.transitionLeave=()=>this.runCSSTransition(t),!e||"object"!=typeof e||e instanceof Function?e instanceof Function?this.transitionEnter=e:this.transitionEnter=()=>Promise.resolve():this.transitionEnter=()=>this.runCSSTransition(e)},useTransition(t){if(!this.transitions[t])throw Error("Unknown transition: "+t);let{leave:e,enter:s}=this.transitions[t];this.setTransitions(e,s)}};window.flowza={init:()=>s.init(),go:t=>s.go(t),on:(t,e)=>s.on(t,e),prefetch:t=>s.prefetch(t),setTransitions:(t,e)=>s.setTransitions(t,e),useTransition:t=>s.useTransition(t)},document.addEventListener("DOMContentLoaded",()=>{flowza.init().catch(console.error)})}();
